(window.webpackJsonp=window.webpackJsonp||[]).push([[47],{dCDH:function(e,t,i){"use strict";i.r(t),i.d(t,"EquipmentsPlannedFibreCoreComponent",(function(){return v}));var a=i("mrSG"),n=i("4R65"),o=i("OT7S"),s=i("ZWlK"),r=i("D4RW"),l=i("dltC"),p=i("Kpmo"),c=i("+X4V"),u=i("TYT/"),h=i("i+93"),m=i("cUzu"),d=i("RaP5"),g=i("ea4N"),v=function(){function e(e,t,i,a){var o=this;this.shapeService=e,this.http=t,this.dataShare=i,this.dialog=a,this.allLinePoints=[],this.allPoints=[],this.allPoints1=[],this.equipmentData=[{name:"Equipment",value:5,color:"#03A9F4",font:"icomoon",fontvalue:"\uec81",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I164"},{name:"Logical Connectivity",value:5,color:"#03A9F4",font:"icomoon",fontvalue:"\uec82",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I174"}],this.equipmentColocatedData=[{name:"Properties",value:5,color:"#8CC63F",font:"icomoon",fontvalue:"\uf112",frequency:.01492,eventname:"sites-tree-properties",radiuscircle:200,deviceType:[{device:"CSS Router",color:"#94C65A",font:"icomoon",fontvalue:"\uec78",value:5},{device:"Joint Closure",color:"#94C65A",font:"icomoon",fontvalue:"\uec79",value:5},{device:"L2 Switch",color:"#94C65A",font:"icomoon",fontvalue:"\uec7a",value:5},{device:"OLT",color:"#94C65A",font:"icomoon",fontvalue:"\uec7b",value:5},{device:"ONT",color:"#03A9F4",font:"icomoon",fontvalue:"\uec7c",value:5},{device:"OTB",color:"#03A9F4",font:"icomoon",fontvalue:"\uec7d",value:5},{device:"Others",color:"#94C65A",font:"icomoon",fontvalue:"\uec7e",value:5},{device:"Splitter",color:"#94C65A",font:"icomoon",fontvalue:"\uec80",value:5},{device:"ISC",color:"#03A9F4",font:"icomoon",fontvalue:"\uec87",value:5}]},{name:"Create Workorder",value:5,color:"#8dc63f",font:"Material-Design-Iconic-Font",fontvalue:"\uf222",disabled:!0,frequency:.02782,radiuscircle:100,eventname:"sites-tree-createworkorder",deviceType:[{device:"AG1",color:"#94C65A",font:"icomoon",fontvalue:"\uec6a",value:5},{device:"Splitter 2",color:"#94C65A",font:"icomoon",fontvalue:"\uec7f",value:5},{device:"OTB",color:"#03A9F4",font:"icomoon",fontvalue:"\uec7d",value:5},{device:"AG1",color:"#03A9F4",font:"icomoon",fontvalue:"\uec6a",value:5},{device:"IBS",color:"#94C65A",font:"icomoon",fontvalue:"\uec86",value:5}]}],this.createLayer=function(e,t,i,a,o){this.lineColors="red",this.allLinePoints=[],this.zoomLevel=t,this.scaleMatrix=this.zoomLevel<=7?.4:this.zoomLevel<=10?.5:this.zoomLevel<=13?.75:this.zoomLevel<=15?.5:.75,this.scaleMatrix=this.scaleMatrix*this.pixelRatio,null!=this.stageRouteContainer&&(this.stageRouteContainer.removeAllChildren(),this.stageRouteContainer.update()),this.stageRouteContainer=new s.Stage(e),this.stageRouteContainer.enableDOMEvents(!0),this.stageRouteContainer.enableMouseOver(5e4),this.stageRouteContainer.removeAllChildren(),this._assetQueue=new s.LoadQueue(!1,null,!0),this._assetQueue.loadManifest(this._plannedSiteImageManifest,!0),this.equipmentContainer=new s.Container;for(var r=0;r<i.length;r++){for(var l=0;l<i[r][4].boundary.length;l++)for(var p in this.allPoints["'"+i[r][1].rj_r4g_state_name+"'"]=[],this.allPoints1["'"+i[r][1].rj_r4g_state_name+"'"]=[],i[r][4].boundary[l])for(var c=0;c<i[r][4].boundary[l][p].length;c++)this.allPoints["'"+i[r][1].rj_r4g_state_name+"'"].push([i[r][4].boundary[l][p][c].latlng[0],i[r][4].boundary[l][p][c].latlng[1]]),this.allPoints1["'"+i[r][1].rj_r4g_state_name+"'"].push([i[r][4].boundary[l][p][c].latlng[0],i[r][4].boundary[l][p][c].latlng[1],i[r][4].boundary[l][p][c].sector,i[r][4].boundary[l][p][c].band,i[r][4].boundary[l][p][c].cnum,i[r][4].boundary[l][p][c].sapid,i[r][4].boundary[l][p][c].type]);var u={},h={};this.allPoints["'"+i[r][1].rj_r4g_state_name+"'"].forEach((function(e){u[e]=(u[e]||0)+1,u[e]>1&&(h[e]=u[e])}));var m={},d={};this.allPoints1["'"+i[r][1].rj_r4g_state_name+"'"].forEach((function(e){m[e]=(m[e]||0)+1,d[e]=m[e]}))}for(var g=Object.entries(h),v=Object.entries(d),C=[],f=0;f<g.length;f++)for(var y=g[f][0].split(",").map(Number),L=0;L<v.length;L++){var q=v[L][0].split(",").map(String);q[0]!=y[0]&&q[1]!=y[1]&&C.push(v[L])}for(var b=0;b<C.length;b++)this.drawEquipmentImage(this.positionLatLng,this.linksCenterPoint,this.equipmentContainer,C[b],this.imagePath);for(f=0;f<g.length;f++)y=g[f][0].split(",").map(Number),this.positionCololatedLatLng=n.latLng({lat:y[0],lng:y[1]}),this.colocatedLinkDot=this.map.latLngToContainerPoint(this.positionCololatedLatLng),this.colocatedLinksCenterPoint={x:this.colocatedLinkDot.x*this.pixelRatio,y:this.colocatedLinkDot.y*this.pixelRatio},this.drawCircularCircle(g[f][1],this.equipmentContainer,this.colocatedLinksCenterPoint,this.mainLayerRef,this.positionCololatedLatLng,[{sapId:"I-MU-MUMB_ENB_014",tileName:"Beta_1800_C1"}],y[0],y[1]),this.stageRouteContainer.addChild(this.equipmentContainer);this.stageRouteContainer.addChild(this.equipmentContainer),this.stageRouteContainer.update()},this.routeReadyFibreCoreSubscription=this.dataShare.removeLayerMessage.subscribe((function(e){"EquipmentsPlannedFibreCoreComponent"==e&&(o.dataShare.removeExtraLayer("Logical-Connectivity"),o.removeLayer())})),this.dataShare.mainLayerMessage.subscribe((function(e){o.mainLayerRef=e}))}return e.prototype.ngAfterViewInit=function(){this.pixelRatio=window.devicePixelRatio||1,this.equipmentPopup=this.getPopup(),this.map=this.shapeService.mapServiceData,this.equipmentPlannedCoreLayer=new o.a({container:document.createElement("canvas")}),this.map.setZoom(4);var e=this;this.equipmentPlannedCoreLayer.on("layer-render",(function(){var t=this,i=this,a=this.componentRef=this;e.getRouteData().subscribe((function(n){t.equipmentPlannedData=n,i.equipmentPlannedLayerContainer=e.resizeContainer(),e.createLayer(i.equipmentPlannedLayerContainer,i._zoom,t.equipmentPlannedData,a,i._assetQueue)}))})),this.equipmentPlannedCoreLayer.addTo(this.map)},e.prototype.getRouteData=function(){return this.http.get("assets/data/layers/topologies/Fibre/equipment/equipment.json")},e.prototype.getPopup=function(){return n.popup({className:"leaflet-fibre-tooltip",minWidth:120,offset:n.point(0,0),closeButton:!1})},e.prototype.resizeContainer=function(){this.canvasCore=this.equipmentPlannedCoreLayer.getContainer();var e=n.Browser.retina?2:1,t=this.equipmentPlannedCoreLayer._bounds.getSize();return this.canvasCore.width=e*t.x,this.canvasCore.height=e*t.y,this.canvasCore.style.width=t.x+"px",this.canvasCore.style.height=t.y+"px",this.canvasCore},e.prototype.drawEquipmentImage=function(e,t,i,a,o){o="";var r=a[0].split(",").map(String);this.zoomLevel<=7?o="assets/images/Layers/topologies/equipment/AG1Router.svg":this.zoomLevel>7&&this.zoomLevel<=11?"JointClosure"==r[6]?o="assets/images/Layers/topologies/equipment/JointClosure.svg":"CSSRouter"==r[6]?o="assets/images/Layers/topologies/equipment/CSSRouter.svg":"L2Switch"==r[6]&&(o="assets/images/Layers/topologies/equipment/L2Switch.svg"):this.zoomLevel>11&&this.zoomLevel<=12&&(o="Splitter2"==r[6]?"assets/images/Layers/topologies/equipment/Splitter2.svg":"Splitter1"==r[6]?"assets/images/Layers/topologies/equipment/Splitter1.svg":"OTB"==r[6]?"assets/images/Layers/topologies/equipment/OTB.svg":"ONT"==r[6]?"assets/images/Layers/topologies/equipment/ONT.svg":"OLT"==r[6]?"assets/images/Layers/topologies/equipment/OLT.svg":"assets/images/Layers/topologies/equipment/Others.svg",o="SAG2"==r[6]?"assets/images/Layers/topologies/equipment/SAG2.svg":"ILA"==r[6]?"assets/images/Layers/topologies/equipment/ILA.svg":"Pole"==r[6]?"assets/images/Layers/topologies/equipment/Pole.svg":"ManHole"==r[6]?"assets/images/Layers/topologies/equipment/ManHole.svg":"FiberPop"==r[6]?"assets/images/Layers/topologies/equipment/FiberPop.svg":"assets/images/Layers/topologies/equipment/AG1.svg"),this.positionLatLng=n.latLng(r[0],r[1]),this.linksDot=this.map.latLngToContainerPoint(this.positionLatLng),this.linksCenterPoint={x:this.linksDot.x*this.pixelRatio,y:this.linksDot.y*this.pixelRatio},this.equipmentContainerEach=new s.Container,this.equipmentContainerEach.cursor="pointer",this.equipmentContainerEach.x=this.linksCenterPoint.x,this.equipmentContainerEach.y=this.linksCenterPoint.y,this.equipmentContainerEach.scaleX=this.scaleMatrix,this.equipmentContainerEach.scaleY=this.scaleMatrix,this.equipmentImage=new s.Bitmap(o),this.equipmentImage.regX=10,this.equipmentImage.regY=30,this.equipmentImage.scaleX=1,this.equipmentImage.scaleY=1,this.equipmentImage.latlng=this.positionLatLng,this.equipmentImage.data=r,this.equipmentImage.image.onload=function(){l.stageRouteContainer.update()},this.equipmentImageText=new s.Text(r[5],"15px Lato Bold","#000000"),this.equipmentImageText.textAlign="center",this.equipmentImageText.textBaseLine="middle",this.equipmentImageText.y=50;var l=this;this.equipmentImage.on("mouseover",(function(e){var t=e.target,i=n.point(e.rawX/l.pixelRatio,e.rawY/l.pixelRatio);t.latlng=l.map.containerPointToLatLng(i);var a="";a+='<div class="layout-row popup-layout-padding"><span class="prefix">Sector:</span><span class="value">'+t.data[2]+"</span></div>",a+='<div class="layout-row popup-layout-padding"><span class="prefix">Band:</span><span class="value">'+t.data[3]+"</span></div>",a+='<div class="layout-row popup-layout-padding"><span class="prefix">cNum:</span><span class="value">'+t.data[4]+"</span></div>",l.equipmentPopup.setLatLng(t.latlng).setContent(a).openOn(l.map)})),this.equipmentImage.on("mouseout",(function(e){l.map.closePopup()})),this.equipmentImage.on("click",(function(e){l.routeClicked()})),this.equipmentContainerEach.addChild(this.equipmentImage,this.equipmentImageText),i.addChild(this.equipmentContainerEach)},e.prototype.openSpiderCircularPopups=function(e,t){var i=t.componentFactoryResolver.resolveComponentFactory(p.a);t.componentRef=t.target.createComponent(i),t.componentRef.instance.colocatedCircleData=[{tileName:e.data.device,fontValue:e.data.fontvalue,fontFamily:e.data.font,color:e.data.color,radiusDeviceCircle:"56"}],t.componentRef.instance.data=this.equipmentData,t.componentRef.instance.mainRef=this,t.componentRef.instance.mainLayerReference=this.mainLayerRef},e.prototype.openSpiderPopups=function(e,t){if("Equipment"==e.data.name){var i=new r.a("Route");this.dialog.open(r.b,{width:"1200px",height:"500px",position:{left:"20.5rem",top:"4rem"},data:i,hasBackdrop:!1,disableClose:!1,panelClass:"route-table"})}else if("Logical Connectivity"==e.data.name){this.dataShare.setExtraLayer({parentToChild:"Logical-Connectivity",child:"Topologies-Equipment-Planned"}),this.dataShare.countLogicalMessage(),this.removeLayer();var a=t.componentFactoryResolver.resolveComponentFactory(c.a);t.componentRef=t.target.createComponent(a)}},e.prototype.routeClicked=function(){var e=new r.a("equipment");this.dialog.open(r.b,{width:"1200px",height:"500px",position:{left:"20.5rem",top:"4rem"},data:e,hasBackdrop:!1,disableClose:!1,panelClass:"route-table"})},e.prototype.removeLayer=function(){null!=this.equipmentPlannedCoreLayer&&this.map.removeLayer(this.equipmentPlannedCoreLayer)},e.prototype.drawCircularCircle=function(e,t,i,o,r,l,p,c){this.stageRouteContainer.removeAllChildren(),this.stageRouteContainer.update(),this.circleGraphic=this.drawCircleGraphics("#003B7440",65),this.circleCountShape=new s.Shape(this.circleGraphic),this.circleCountShape.alpha=.4,this.innercircleGraphic=this.drawCircleGraphics("#003A74",21),this.innercircleShape=new s.Shape(this.innercircleGraphic),this.textContainer=new s.Container,this.textContainer.x=i.x,this.textContainer.y=i.y,this.textContainer.latLng=new n.LatLng(p,c),this.labelCount=new s.Bitmap("assets/images/Layers/topologies/equipment/All.svg"),this.labelCount.regX=35,this.labelCount.regY=30,this.labelCount.scaleX=.4,this.labelCount.scaleY=.4,this.labelCount.latlng=this.textContainer.latLng;var u=this;this.textContainer.addEventListener("click",(function(t){u.clonedArray=Object(a.h)(u.equipmentColocatedData),u.clonedArray.splice(e,u.clonedArray.length-e),u.map.setView(r),u.colocatedequipmentClicked(t,o,l,u.clonedArray)})),this.textContainer.addChild(this.circleCountShape,this.innercircleShape,this.labelCount),t.addChild(this.textContainer),this.stageRouteContainer.update()},e.prototype.drawCircleGraphics=function(e,t){return this.drawCircleGraphic=new s.Graphics,this.drawCircleGraphic.beginFill(e),this.drawCircleGraphic.drawCircle(0,0,t),this.drawCircleGraphic},e.prototype.colocatedequipmentClicked=function(e,t,i,n){return Object(a.b)(this,void 0,void 0,(function(){var e;return Object(a.e)(this,(function(a){return e=t.componentFactoryResolver.resolveComponentFactory(l.a),t.componentRef=t.target.createComponent(e),t.componentRef.instance.data=n,t.componentRef.instance.colocatedCircularCircleData=i,t.componentRef.instance.mainRef=this,t.componentRef.instance.mainLayerReference=t,t.componentRef.instance.type="equipment",[2]}))}))},e.prototype.ngOnDestroy=function(){this.routeReadyFibreCoreSubscription&&this.routeReadyFibreCoreSubscription.unsubscribe()},e.\u0275fac=function(t){return new(t||e)(u.Ub(h.a),u.Ub(m.b),u.Ub(d.a),u.Ub(g.b))},e.\u0275cmp=u.Ob({type:e,selectors:[["app-equipments-planned-fibre-core"]],decls:2,vars:0,template:function(e,t){1&e&&(u.ac(0,"p"),u.Vc(1,"equipments-planned-fibre-core works!"),u.Zb())},styles:[""],encapsulation:2}),e}()}}]);