(window.webpackJsonp=window.webpackJsonp||[]).push([[48],{hTQG:function(e,t,a){"use strict";a.r(t),a.d(t,"RoutePlannedFibreCoreComponent",(function(){return g}));var i=a("mrSG"),n=a("TYT/"),o=a("4R65"),r=a("OT7S"),s=a("ZWlK"),l=a("D4RW"),h=a("Kpmo"),c=a("lcx6"),p=a.n(c),d=a("i+93"),u=a("cUzu"),C=a("RaP5"),y=a("ea4N"),v=["tref"],g=function(){function e(e,t,a,i,n,r,l,h,c){var p=this;this.shapeService=e,this.http=t,this.dataShare=a,this.viewContainerRef=i,this.cfr=n,this.dialog=r,this.elRef=l,this.renderer=h,this.componentFactoryResolver=c,this.allLinePoints=[],this.allPoints=[],this.routePlannedLayerHeader={title:"Route Planned Fibre Core",headerSapid:"Maharashtra-NP-CV-121020_v1"},this.routePlannedSpiderViewData=[{name:"CSS",value:5,color:"#F44336",font:"Lato Bold",fontvalue:"\uf112",eventname:"sites-tree-properties-nominals",sapid:"I-MU-MUMB_ENB_I144"},{name:"Core",value:5,color:"#03A9F4",font:"Material-Design-Iconic-Font",fontvalue:"\uf207",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I124"},{name:"Lorem",value:5,color:"#E2C10D",font:"Material-Design-Iconic-Font",fontvalue:"\uf207",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I144"},{name:"Lorem",value:5,color:"#3F51B4",font:"Material-Design-Iconic-Font",fontvalue:"\uf207",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I244"},{name:"Lorem",value:5,color:"#FF862C",font:"Material-Design-Iconic-Font",fontvalue:"\uf207",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I044"},{name:"Lorem",value:5,color:"#C550F0",font:"Material-Design-Iconic-Font",fontvalue:"\uf207",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I544"},{name:"Lorem",value:5,color:"#4CAF50",font:"Material-Design-Iconic-Font",fontvalue:"\uf207",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I134"},{name:"Lorem",value:5,color:"#C550F0",font:"Material-Design-Iconic-Font",fontvalue:"\uf207",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I164"},{name:"Lorem",value:5,color:"#C550F0",font:"Material-Design-Iconic-Font",fontvalue:"\uf207",eventname:"sites-tree-candidates-nominals",sapid:"I-MU-MUMB_ENB_I174"}],this.a=this.routePlannedSpiderViewData,this.createLayer=function(e,t,a,i){var n=this;if(this.lineColors="red",this.allLinePoints=[],this.zoomLevel=t,this.scaleMatrix=this.zoomLevel<=7?.4:this.zoomLevel<=10?.5:this.zoomLevel<=13?.75:this.zoomLevel<=15?.5:.75,this.scaleMatrix=this.scaleMatrix*this.pixelRatio,null!=this.stageRouteContainer&&(this.stageRouteContainer.removeAllChildren(),this.stageRouteContainer.update()),this.stageRouteContainer=new s.Stage(e),this.stageRouteContainer.enableDOMEvents(!0),this.stageRouteContainer.enableMouseOver(5e4),this.stageRouteContainer.removeAllChildren(),this.zoomLevel<=6)this.getBoundariesData("assets/data/layers/boundaries/circles.json").subscribe((function(e){n.boundariesData=e,n.drawBoundaries(n.boundariesData,n.routePlannedData)}));else{this.colocatedContainer=new s.Container,this.lineContainer=new s.Container;for(var r=0;r<a.length;r++){for(var l=0;l<a[r][4].boundary.length;l++)for(var h in this.allPoints["'"+a[r][1].rj_r4g_state_name+"'"]=[],a[r][4].boundary[l]){this.allLinePoints=[];for(var c=0;c<a[r][4].boundary[l][h].length;c++)this.positionLatLng=o.latLng({lat:a[r][4].boundary[l][h][c][0],lng:a[r][4].boundary[l][h][c][1]}),this.linksDot=this.map.latLngToContainerPoint(this.positionLatLng),this.linksCenterPoint={x:this.linksDot.x*this.pixelRatio,y:this.linksDot.y*this.pixelRatio},this.allLinePoints.push(this.linksCenterPoint),this.allPoints["'"+a[r][1].rj_r4g_state_name+"'"].push([a[r][4].boundary[l][h][c][0],a[r][4].boundary[l][h][c][1]]);this.polyGraphic=this.drawPolyGraphics(this.lineColors,this.allLinePoints),this.lineShape=new s.Shape(this.polyGraphic),this.lineShape.cursor="pointer",this.lineShape.points=this.allLinePoints,this.lineShape.latLng=this.positionLatLng,this.lineContainer.addChild(this.lineShape)}var p={},d={};this.allPoints["'"+a[r][1].rj_r4g_state_name+"'"].forEach((function(e){p[e]=(p[e]||0)+1,p[e]>1&&(d[e]=p[e])}))}var u=this;this.lineContainer.addEventListener("click",(function(e){u.routeClicked(u.mainLayerRef)}));for(var C=Object.entries(d),y=function(e){console.log(C[e][0].split(","));var t=C[e][0].split(",").map(Number);v.positionCololatedLatLng=o.latLng({lat:t[0],lng:t[1]}),v.colocatedLinkDot=v.map.latLngToContainerPoint(v.positionCololatedLatLng),v.colocatedLinksCenterPoint={x:v.colocatedLinkDot.x*v.pixelRatio,y:v.colocatedLinkDot.y*v.pixelRatio},v.lineContainer.alpha=1;var a=v;v.lineContainer.on("mouseover",(function(e){var t=e.target;t.alpha=.6,t.graphics._strokeStyle.width=6*a.scaleMatrix,a.stageRouteContainer.update();var i=o.point(e.rawX/a.pixelRatio,e.rawY/a.pixelRatio);t.latlng=a.map.containerPointToLatLng(i),a.routeHover.setLatLng(t.latlng).setContent('<div class="layout-row popup-layout-padding"><span class="prefix">Measured Length:</span><span class="value">2000km</span></div><div class="layout-row popup-layout-padding"><span class="prefix">Start:</span><span class="value">Mumbai</span></div><div class="layout-row popup-layout-padding"><span class="prefix">End:</span><span class="value">Surat</span></div><div class="layout-row popup-layout-padding"><span class="prefix">Type:</span><span class="value">Core</span></div>').openOn(a.map)})),v.lineContainer.on("mouseout",(function(e){a.map.closePopup();var t=e.target;t.alpha=1,t.graphics._strokeStyle.width=4*a.scaleMatrix,a.stageRouteContainer.update()})),v.drawCountCircle(C[e][1],v.lineContainer,v.colocatedContainer,v.colocatedLinksCenterPoint,u.mainLayerRef,v.positionCololatedLatLng,[{sapId:"I-MU-MUMB_ENB_014",tileName:"Beta_1800_C1"}]),v.stageRouteContainer.addChild(v.lineContainer,v.colocatedContainer)},v=this,g=0;g<C.length;g++)y(g)}this.stageRouteContainer.update()},this.routeReadyFibreCoreSubscription=this.dataShare.removeLayerMessage.subscribe((function(e){"RoutePlannedFibreCoreComponent"==e&&p.removeLayer()})),this.dataShare.mainLayerMessage.subscribe((function(e){p.mainLayerRef=e,console.log(p.mainLayerRef)}))}return e.prototype.ngAfterViewInit=function(){this.pixelRatio=window.devicePixelRatio||1,this.routeHover=this.getPopup(),this.map=this.shapeService.mapServiceData,this.routeFibreCoreLayer=new r.a({container:document.createElement("canvas")}),this.map.setZoom(5);var e=this;this.routeFibreCoreLayer.on("layer-render",(function(){var t=this,a=this,i=this.componentRef=this;e.getRouteData().subscribe((function(n){t.routePlannedData=n,a.routeFibreCoreLayerContainer=e.resizeContainer(),e.createLayer(a.routeFibreCoreLayerContainer,a._zoom,t.routePlannedData,i)}))})),this.routeFibreCoreLayer.addTo(this.map)},e.prototype.getRouteData=function(){return this.http.get("assets/data/layers/topologies/Fibre/Route/planned.json")},e.prototype.resizeContainer=function(){this.canvasCore=this.routeFibreCoreLayer.getContainer();var e=o.Browser.retina?2:1,t=this.routeFibreCoreLayer._bounds.getSize();return this.canvasCore.width=e*t.x,this.canvasCore.height=e*t.y,this.canvasCore.style.width=t.x+"px",this.canvasCore.style.height=t.y+"px",this.canvasCore},e.prototype.getPopup=function(){return o.popup({className:"leaflet-fibre-tooltip",minWidth:120,offset:o.point(0,0),closeButton:!1})},e.prototype.getBoundariesData=function(){return this.http.get("assets/data/layers/boundaries/circles.json")},e.prototype.drawBoundaries=function(e){this.boundariesContainer=new s.Container,this.labelsContainer=new s.Container;for(var t=0;t<e.length;t++){for(var a=e[t],i=a.coordinates,n=i.length,r=[],l=0;l<n;l++){var h=i[l],c=this.map.latLngToContainerPoint([h[0],h[1]]);r.push({x:c.x*this.pixelRatio,y:c.y*this.pixelRatio})}if(r.length){var d=this.getPolyGraphics(s.Graphics.getRGB(248,152,29,.8),"#E35425",r),u=new s.Shape(d);u.name=a.CIRCLENAME,u.cursor="pointer",u.points=r;var C=new s.Shadow("rgba(0,0,0,0.5)",1,2,5);this.boundariesContainer.addChild(u);var y=p()([i],.1);if(y&&y[0]){var v={x:(c=this.map.latLngToContainerPoint([y[0],y[1]])).x*this.pixelRatio,y:c.y*this.pixelRatio},g=o.Browser.retina?30:15,m=Math.floor(25e3*Math.random()+5e3),f=new s.Text(m,"bold "+g+"px Roboto","#000000");f.textAlign="center",f.textBaseline="middle",f.outline=2,f.x=v.x,f.y=v.y;var b=f.clone();b.outline=!1,b.shadow=C,b.color="#FFFFFF",this.labelsContainer.addChild(f,b)}}}this.stageRouteContainer.addChild(this.boundariesContainer,this.labelsContainer),this.stageRouteContainer.update()},e.prototype.getPolyGraphics=function(e,t,a){var i=new s.Graphics;return i.setStrokeStyle(2),i.beginStroke(t),i.beginFill(e),i},e.prototype.drawPolyGraphics=function(e,t){this.lineStrokeWidth=4*this.scaleMatrix,this.drawPolyGraphic=new s.Graphics,this.drawPolyGraphic.setStrokeStyle(this.lineStrokeWidth,1,1),this.drawPolyGraphic.beginStroke(e);for(var a=0;a<t.length;a+=2)this.drawPolyGraphic.curveTo(t[a].x,t[a].y,t[a+1].x,t[a+1].y);return this.drawPolyGraphic.endStroke(),this.drawPolyGraphic.closePath(),this.drawPolyGraphic},e.prototype.drawCountCircle=function(e,t,a,n,r,l,h,c){this.circleGraphic=this.drawCircleGraphics("red",15),this.circleCountShape=new s.Shape(this.circleGraphic),this.textContainer=new s.Container,this.textContainer.x=n.x,this.textContainer.y=n.y,this.textContainer.latLng=new o.LatLng(t.children[0].latLng.lat,t.children[0].latLng.lng),this.labelCount=new s.Text(e,"bold 12px RobotoDraft","#000000"),this.labelCount.textAlign="center",this.labelCount.textBaseLine="middle";var p=this;this.textContainer.addEventListener("click",(function(t){p.clonedArray=Object(i.h)(p.routePlannedSpiderViewData),p.clonedArray.splice(e,p.clonedArray.length-e),p.map.setView(l),p.colocatedLineClicked(t,r,h,p.clonedArray)})),this.textContainer.addChild(this.circleCountShape,this.labelCount),a.addChild(this.textContainer),this.stageRouteContainer.update()},e.prototype.drawCircleGraphics=function(e,t){return this.drawCircleGraphic=new s.Graphics,this.drawCircleGraphic.setStrokeStyle(1),this.drawCircleGraphic.beginStroke(s.Graphics.getRGB(0,0,0,.5)),this.drawCircleGraphic.beginFill(e),this.drawCircleGraphic.drawCircle(0,0,t),this.drawCircleGraphic},e.prototype.drawRouteCount=function(e,t,a){var i=o.Browser.retina?2:1;this.textContainerBoundary=new s.Container,this.textContainerBoundary.x=t.x*i,this.textContainerBoundary.y=t.y*i,this.pixelValue=o.Browser.retina?"bold 30px RobotoDraft":"bold 15px RobotoDraft",this.labelCountBoundary=new s.Text(e,this.pixelValue,"#000000"),this.labelCountBoundary.textAlign="center",this.textContainerBoundary.addChild(this.labelCountBoundary),a.addChild(this.textContainerBoundary)},e.prototype.routeClicked=function(e){var t=new l.a("Route");this.dialog.open(l.b,{width:"1200px",height:"500px",position:{left:"18.5rem",top:"4rem"},data:t,hasBackdrop:!1,disableClose:!1,panelClass:"material-dialog-container"})},e.prototype.colocatedLineClicked=function(e,t,a,i){var n=t.componentFactoryResolver.resolveComponentFactory(h.a);t.componentRef=t.target.createComponent(n),t.componentRef.instance.data=i,t.componentRef.instance.colocatedCircleData=a,t.componentRef.instance.mainRef=this},e.prototype.removeLayer=function(){null!=this.routeFibreCoreLayer&&this.map.removeLayer(this.routeFibreCoreLayer)},e.prototype.openSpiderPopups=function(e,t){var a=new l.a("Route");this.dialog.open(l.b,{width:"1200px",height:"500px",position:{left:"18.5rem",top:"4rem"},data:a,hasBackdrop:!1,disableClose:!1,panelClass:"material-dialog-container"})},e.prototype.ngOnDestroy=function(){this.routeReadyFibreCoreSubscription&&this.routeReadyFibreCoreSubscription.unsubscribe()},e.\u0275fac=function(t){return new(t||e)(n.Ub(d.a),n.Ub(u.b),n.Ub(C.a),n.Ub(n.Q),n.Ub(n.j),n.Ub(y.b),n.Ub(n.l),n.Ub(n.G),n.Ub(n.j))},e.\u0275cmp=n.Ob({type:e,selectors:[["app-route-planned-fibre-core"]],viewQuery:function(e,t){var a;1&e&&n.cd(v,!0,n.l),2&e&&n.Hc(a=n.nc())&&(t.tref=a.first)},decls:2,vars:0,template:function(e,t){1&e&&(n.ac(0,"p"),n.Vc(1,"route-planned-fibre-core works!"),n.Zb())},styles:[""]}),e}()}}]);