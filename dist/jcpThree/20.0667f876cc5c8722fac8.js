(window.webpackJsonp=window.webpackJsonp||[]).push([[20],{"4u43":function(t,i,e){"use strict";e.r(i),e.d(i,"OdscLayerComponent",(function(){return d}));var s=e("4R65"),o=e("OT7S"),n=e("ZWlK"),a=e("TYT/"),r=e("i+93"),h=e("cUzu"),c=e("RaP5"),d=function(){function t(t,i,e){var s=this;this.shapeService=t,this.http=i,this.dataShare=e,this.allPoints=[],this.allPoints1=[],this.createLayer=function(t,i,e,s){this.zoomLevel=i,this.scaleMatrix=this.zoomLevel<=7?.4:this.zoomLevel<=10?.5:this.zoomLevel<=13?.75:this.zoomLevel<=15?.5:.75,this.scaleMatrix=this.scaleMatrix*this.pixelRatio,null!=this.odscContainer&&(this.odscContainer.removeAllChildren(),this.odscContainer.update()),this.odscContainer=new n.Stage(t),this.odscContainer.enableDOMEvents(!0),this.odscContainer.enableMouseOver(5e4),this.odscContainer.removeAllChildren(),this._assetQueue=new n.LoadQueue(!1,null,!0),this._assetQueue.loadManifest(this._plannedSiteImageManifest,!0),this.odscImageContainer=new n.Container;for(var o=0;o<e.length;o++){for(var a=0;a<e[o][4].boundary.length;a++)for(var r in this.allPoints["'"+e[o][1].rj_r4g_state_name+"'"]=[],this.allPoints1["'"+e[o][1].rj_r4g_state_name+"'"]=[],e[o][4].boundary[a])for(var h=0;h<e[o][4].boundary[a][r].length;h++)this.allPoints["'"+e[o][1].rj_r4g_state_name+"'"].push([e[o][4].boundary[a][r][h].latlng[0],e[o][4].boundary[a][r][h].latlng[1]]),this.allPoints1["'"+e[o][1].rj_r4g_state_name+"'"].push([e[o][4].boundary[a][r][h].latlng[0],e[o][4].boundary[a][r][h].latlng[1],e[o][4].boundary[a][r][h].sector,e[o][4].boundary[a][r][h].band,e[o][4].boundary[a][r][h].cnum,e[o][4].boundary[a][r][h].sapid,e[o][4].boundary[a][r][h].type]);var c={},d={};this.allPoints["'"+e[o][1].rj_r4g_state_name+"'"].forEach((function(t){c[t]=(c[t]||0)+1,c[t]>1&&(d[t]=c[t])}));var l={},p={};this.allPoints1["'"+e[o][1].rj_r4g_state_name+"'"].forEach((function(t){l[t]=(l[t]||0)+1,p[t]=l[t]}))}for(var u=Object.entries(d),m=Object.entries(p),y=[],g=0;g<u.length;g++)for(var _=u[g][0].split(",").map(Number),f=0;f<m.length;f++){var v=m[f][0].split(",").map(String);v[0]!=_[0]&&v[1]!=_[1]&&y.push(m[f])}for(var b=0;b<y.length;b++)this.drawOdscImage(this.odscImageContainer,y[b]);this.odscContainer.addChild(this.odscImageContainer),this.odscContainer.update()},this.odscLayerSubscription=this.dataShare.removeLayerMessage.subscribe((function(t){"OdscLayerComponent"==t&&s.removeLayer()})),this.dataShare.mainLayerMessage.subscribe((function(t){s.mainLayerRef=t,console.log(s.mainLayerRef)}))}return t.prototype.ngAfterViewInit=function(){this.pixelRatio=window.devicePixelRatio||1,this.map=this.shapeService.mapServiceData,this.odscPopup=this.getPopup(),this.odscLayer=new o.a({container:document.createElement("canvas")}),this.map.setView(new s.LatLng(15.620236,73.729269),9);var t=this;this.odscLayer.on("layer-render",(function(){var i=this,e=this,s=this.componentRef=this;t.getOdscLayerData().subscribe((function(o){i.odscData=o,e.odscLayerContainer=t.resizeContainer(),t.createLayer(e.odscLayerContainer,e._zoom,i.odscData,s)}))})),this.odscLayer.addTo(this.map)},t.prototype.drawOdscImage=function(t,i){var e=i[0].split(",").map(String);this.positionLatLng=s.latLng(e[0],e[1]),this.linksDot=this.map.latLngToContainerPoint(this.positionLatLng),this.linksCenterPoint={x:this.linksDot.x*this.pixelRatio,y:this.linksDot.y*this.pixelRatio},this.odscContainerEach=new n.Container,this.odscContainerEach.cursor="pointer",this.odscContainerEach.x=this.linksCenterPoint.x,this.odscContainerEach.y=this.linksCenterPoint.y,this.odscContainerEach.scaleX=this.scaleMatrix,this.odscContainerEach.scaleY=this.scaleMatrix,this.odscImage=new n.Bitmap("assets/images/Layers/topologies/structure/OSC.svg"),this.odscImage.regX=10,this.odscImage.regY=30,this.odscImage.scaleX=1,this.odscImage.scaleY=1,this.odscImage.latlng=this.positionLatLng,this.odscImage.data=i;var o=this;this.odscImage.image.onload=function(){o.odscContainer.update()},this.odscImageText=new n.Text(e[5],"15px Lato Bold","#000000"),this.odscImageText.textAlign="center",this.odscImageText.textBaseLine="middle",this.odscImageText.y=50,this.odscImage.on("mouseover",(function(t){var i=t.target,e=s.point(t.rawX/o.pixelRatio,t.rawY/o.pixelRatio);i.latlng=o.map.containerPointToLatLng(e);var n="";n+='<div class="layout-row popup-layout-padding"><span class="prefix">Sector:</span><span class="value">'+i.data[2]+"</span></div>",n+='<div class="layout-row popup-layout-padding"><span class="prefix">Band:</span><span class="value">'+i.data[3]+"</span></div>",n+='<div class="layout-row popup-layout-padding"><span class="prefix">cNum:</span><span class="value">'+i.data[4]+"</span></div>",o.odscPopup.setLatLng(i.latlng).setContent(n).openOn(o.map)})),this.odscImage.on("mouseout",(function(t){o.map.closePopup()})),this.odscImage.on("click",(function(t){})),this.odscContainerEach.addChild(this.odscImage,this.odscImageText),t.addChild(this.odscContainerEach)},t.prototype.getPopup=function(){return s.popup({className:"leaflet-fibre-tooltip",minWidth:120,offset:s.point(0,0),closeButton:!1})},t.prototype.getOdscLayerData=function(){return this.http.get("assets/data/layers/topologies/Fibre/equipment/equipment.json")},t.prototype.resizeContainer=function(){this.canvasCore=this.odscLayer.getContainer();var t=s.Browser.retina?2:1,i=this.odscLayer._bounds.getSize();return this.canvasCore.width=t*i.x,this.canvasCore.height=t*i.y,this.canvasCore.style.width=i.x+"px",this.canvasCore.style.height=i.y+"px",this.canvasCore},t.prototype.removeLayer=function(){null!=this.odscLayer&&this.map.removeLayer(this.odscLayer)},t.prototype.ngOnDestroy=function(){this.odscLayerSubscription&&this.odscLayerSubscription.unsubscribe()},t.\u0275fac=function(i){return new(i||t)(a.Ub(r.a),a.Ub(h.b),a.Ub(c.a))},t.\u0275cmp=a.Ob({type:t,selectors:[["app-odsc-layer"]],decls:2,vars:0,template:function(t,i){1&t&&(a.ac(0,"p"),a.Vc(1,"odsc-layer works!"),a.Zb())},styles:[""]}),t}()},OT7S:function(t,i,e){"use strict";e.d(i,"a",(function(){return n}));var s=e("4R65"),o=e.n(s),n=o.a.Layer.extend({options:{padding:0,tolerance:0,container:null,opacity:1,visible:!0,zIndex:void 0,minZoom:0,maxZoom:18},initialize:function(t){o.a.setOptions(this,t),o.a.stamp(this),this._map=void 0,this._container=void 0,this._bounds=void 0,this._center=void 0,this._zoom=void 0,this._padding=void 0},beforeAdd:function(){this._zoomVisible=!0},getEvents:function(){var t={viewreset:this._onLayerViewReset,zoom:this._onLayerZoom,moveend:this._onLayerMoveEnd,zoomend:this._onLayerZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onLayerAnimZoom),t},onAdd:function(){if(this.fire("layer-beforemount"),this._container||this._initContainer(),this.setOpacity(this.options.opacity),window.isNaN(this.options.zIndex))switch(this._container.tagName){case"CANVAS":this.setZIndex(100);break;case"svg":this.setZIndex(200);break;default:this.setZIndex(100)}else this.setZIndex(this.options.zIndex);this.getPane().appendChild(this._container),this._onZoomVisible(),this.fire("layer-mounted"),this._update()},onRemove:function(){this.fire("layer-beforedestroy"),this._destroyContainer(),this.fire("layer-destroyed")},_onLayerViewReset:function(){this._reset()},_onLayerAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onLayerZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_onLayerZoomEnd:function(){},_onLayerMoveEnd:function(){this._isZoomVisible()?this._update():this._zoomHide()},_onZoomVisible:function(){this._isZoomVisible()?this._zoomShow():this._zoomHide()},_initContainer:function(){var t=this._container=this.options.container;o.a.DomUtil.addClass(t,"leaflet-layer"),this._zoomAnimated&&o.a.DomUtil.addClass(this._container,"leaflet-zoom-animated")},_destroyContainer:function(){o.a.DomUtil.remove(this._container),delete this._container},_isZoomVisible:function(){var t=this.options.minZoom,i=this.options.maxZoom,e=this._map.getZoom();return e>=t&&e<=i},_zoomShow:function(){this._zoomVisible||(this._zoomVisible=!0,this._map.off({zoomend:this._onZoomVisible},this),this.options.visible&&(this._map.on(this.getEvents(),this),this.getContainer().style.display=""))},_zoomHide:function(){this._zoomVisible&&(this._zoomVisible=!1,this._map.off(this.getEvents(),this),this._map.on({zoomend:this._onZoomVisible},this),this.getContainer().style.display="none")},_updateTransform:function(t,i){var e=this._map.getZoomScale(i,this._zoom),s=o.a.DomUtil.getPosition(this._container),n=this._map.getSize().multiplyBy(.5+this.options.padding),a=this._map.project(this._center,i),r=this._map.project(t,i).subtract(a),h=n.multiplyBy(-e).add(s).add(n).subtract(r);o.a.Browser.any3d?o.a.DomUtil.setTransform(this._container,h,e):o.a.DomUtil.setPosition(this._container,h)},_update:function(){this._map._animatingZoom&&this._bounds||(this.__update(),o.a.DomUtil.setPosition(this._container,this._bounds.min),this.fire("layer-render"))},__update:function(){var t=this.options.padding,i=this._map.getSize(),e=this._map.containerPointToLayerPoint(i.multiplyBy(-t));this._padding=i.multiplyBy(t),this._bounds=new o.a.Bounds(e,e.add(i.multiplyBy(1+2*t))),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom)},getContainer:function(){return this._container},setContainer:function(t){var i=this.getContainer(),e=i.parentNode;if(delete this._container,this.options.container=t,this._container||this._initContainer(),this.setOpacity(this.options.opacity),window.isNaN(this.options.zIndex))switch(this._container.tagName){case"CANVAS":this.setZIndex(100);break;case"svg":this.setZIndex(200);break;default:this.setZIndex(100)}else this.setZIndex(this.options.zIndex);return e?e.replaceChild(t,i):this.getPane().appendChild(t),this._update(),this},getOpacity:function(){return this.options.opacity},setOpacity:function(t){return this.getContainer().style.opacity=this.options.opacity=1*t,this},getZIndex:function(){return this.options.zIndex},setZIndex:function(t){return this.getContainer().style.zIndex=this.options.zIndex=1*t,this},show:function(){if(!this.options.visible){if(this.options.visible=!0,this._isZoomVisible())return this._map.on(this.getEvents(),this),this.getContainer().style.display="",this._update(),this;this._zoomHide()}},hide:function(){if(this.options.visible)return this.options.visible=!1,this._zoomHide(),this._map.off(this.getEvents(),this),this.getContainer().style.display="none",this},setFullLayerBounds:function(){var t=this.getContainer(),i=this._bounds.getSize(),e=this._padding;switch(t.tagName){case"CANVAS":var s=o.a.Browser.retina?2:1;t.width=s*i.x,t.height=s*i.y,t.style.width=i.x+"px",t.style.height=i.y+"px";var n=t.getContext("2d");return o.a.Browser.retina&&n.scale(s,s),n.translate(e.x,e.y),{container:t,ctx:n,dpr:s};case"svg":return t.setAttribute("width",i.x),t.setAttribute("height",i.y),t.style.width=i.x+"px",t.style.height=i.y+"px",t.setAttribute("viewBox","".concat(-e.x," ").concat(-e.y," ").concat(i.x," ").concat(i.y)),{container:t};case"DIV":return t.style.boxSizing="content-box",t.style.width=i.x-e.x+"px",t.style.height=i.y-e.y+"px",t.style.padding="".concat(e.y,"px ").concat(e.x,"px"),{container:t};default:return t.setAttribute("width",i.x),t.setAttribute("height",i.y),t.style.width=i.x+"px",t.style.height=i.y+"px",{container:t}}}});o.a.CustomLayer=n,o.a.customLayer=function(t){return o.a.customLayer?new n(t):null}}}]);